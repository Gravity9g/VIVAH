<!-- Common Library functions pageAuthor: Sanjay Bhosale-----------------------------------------------------------------------------------------------------| Version Info  |  Date           | Autor              | Description                                || 0.1           | 27th Sept 2016  | Sanjay Bhosale     | All common functions are defined here	    || 0.2           | 14th Dec 2016   | Sanjay Bhosale     | Added No DB connection Error, Email in use ||               |                 |                    | Mob No in use message, Existance of email, ||               |                 |                    | mob no, incomplete form message.           |-------------------------------------------------------------------------------------------------------><?phprequire_once('const.php');function read_config_file($config_file){	if(!is_file($config_file)){		return array(False, "$config_file Not Found");	}	$settings = parse_ini_file($config_file);	if($settings === False){		echo "$!";		return array(False, "Unable to parse $config_file");	}	return array(True, $settings);}function get_db_connection($config_file=NULL){	if(is_null($config_file)){		$config_file = get_db_config_file();	}	list($return_val, $return_details) = read_config_file($config_file);	if($return_val == False){		return array($return_val, $return_details);	}		$db_host = $db_name = $db_user = $db_pswd = "";		if(array_key_exists('host', $return_details)){		$db_host = $return_details['host'];	}else{		return array(False, "database host(host) key not present in config file");	}		if(array_key_exists('name', $return_details)){		$db_name = $return_details['name'];	}else{		return array(False, "database name(name) key not present in config file");	}		if(array_key_exists('user', $return_details)){		$db_user = $return_details['user'];	}else{		return array(False, "database user name(user) key not present in config file");	}		if(array_key_exists('pswd', $return_details)){		$db_pswd = $return_details['pswd'];	}else{		return array(False, "database password for user $db_user (pswd) key not present in config file");	}	try{		$conn = new PDO("mysql:host=$db_host;dbname=$db_name", $db_user, $db_pswd);		$conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);	}catch (PDOException $e){		return array(False, $e->getMessage());	}	return array(True, $conn);}function is_user_exists($db_connection, $user_name, $user_pswd){	$users_login_table = 'user_login_info';	$user_login_name_column = 'user_login_name';	$user_login_pswd_column = 'user_password';		$select_query = "select count(*)					 from `$users_login_table`					 where 						`$user_login_name_column`='$user_name' and 						`$user_login_pswd_column`='$user_pswd'";	$stmt = $db_connection->prepare($select_query);	$stmt->execute();	$row = $stmt->fetchAll(PDO::FETCH_NUM);	unset($stmt);	if($row[0][0] > 0){		return True;	}	return False;}function redirect_to_page($page){	header('Location: '.$page);}function redirect_to_home($err_msg = ""){	$host  = $_SERVER['HTTP_HOST'];	$uri   = rtrim(dirname($_SERVER['PHP_SELF']), '/\\');	$home_page = "http://$host$uri/index.php";	if($err_msg != ""){		$home_page = $home_page."?error=$err_msg";	}	redirect_to_page($home_page);}function get_udne_message($user_name){		/* User does not exists message */	$message = "No such user with name $user_name exists";	return $message;}// 0.2 Startfunction get_ndbc_message(){				/* No Database connection message */	$message = "No database connection. Please try after some time.";	return $message;}function is_email_exists($db_connection, $email_address){	$users_info_table = 'user_basic_info';	$user_emailid_column = 'email_id';		$select_query = "select count(*)					 from `$users_info_table`					 where 						`$user_emailid_column`='$email_address'";	$stmt = $db_connection->prepare($select_query);	$stmt->execute();	$row = $stmt->fetchAll(PDO::FETCH_NUM);	unset($stmt);	if($row[0][0] > 0){		return True;	}	return False;}function is_mobno_exists($db_connection, $mob_no){	$users_info_table = 'user_basic_info';	$user_mob_no_column = 'mobile_number';		$select_query = "select count(*)					 from `$users_info_table`					 where 						`$user_mob_no_column`='$mob_no'";	$stmt = $db_connection->prepare($select_query);	$stmt->execute();	$row = $stmt->fetchAll(PDO::FETCH_NUM);	unset($stmt);	if($row[0][0] > 0){		return True;	}	return False;}function get_eau_message($email_address){				  	/* Email already in use message */	$message = "Email $email_address already in user. Please try with diiferent email address.";	return $message;}function get_mau_message($mobile_no){				  	/* Mobile already in use message */	$message = "Mobile Number $mobile_no already in user. Please try with diiferent email address.";	return $message;}function get_form_message($mobile_no){				  	/* Incomplete form */	$message = "Please fill form completely.";	return $message;}// 0.2 Endfunction get_gender_information($db_connection, $gender=NULL){	// fetch all gender information	$users_info_table = 'gender';	$user_gender_column = 'genders';	$user_gender_id_column = 'g_id';		$select_query = "select `$user_gender_column`, `$user_gender_id_column`					 from `$users_info_table`";	if(!is_null($gender)){		$select_query = "$select_query where $user_gender_column='$gender'";	}	$stmt = $db_connection->prepare($select_query);	$stmt->execute();	$row = $stmt->fetchAll(PDO::FETCH_NUM);	unset($stmt);	if(!is_null($gender)){		if(sizeof($row) == 0){			return 0;		}		return $row[0][1];	}	return $row;}function register_user($last_name, $middle_name, $first_name, $sex, $interest, $email, $mob_no, $birth_date_time, $password, $db_connection){		$gender = get_gender_information($db_connection, $sex);	if($gender == 0){		return False;	}		$users_info_table = 'user_basic_info';	$first_name_column = 'first_name';	$middle_name_column = 'middle_name';	$last_name_column = 'last_name';	$emailid_column = 'email_id';	$dob_column = 'date_of_birth';	$gender_column = 'gender';	$mobno_column = 'mobile_number';	$reg_date_column = 'registration_date';		$select_query = "select count(*)					 from `$users_info_table`					 where 						`$user_mob_no_column`='$mob_no'";	$stmt = $db_connection->prepare($select_query);	$stmt->execute();	$row = $stmt->fetchAll(PDO::FETCH_NUM);	unset($stmt);	if($row[0][0] > 0){		return True;	}	return False;}function check_exists($array_to_check, $elements){	foreach($elements as $element){		if(!isset($array_to_check[$element]) || $array_to_check[$element]==''){			return $element;		}	}	return NULL;}function get_prev_page_base_url(){	$prev_page = $_SERVER['HTTP_REFERER'];	if(substr($prev_page, -1) == '/'){		$prev_page = $prev_page."index.php";	}	$uri_parts = explode('?', $prev_page, 2);	$prev_page = $uri_parts[0];	return $prev_page;}?>